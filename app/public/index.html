<!DOCTYPE html>
<html>

<head>

	<style type="text/css">
		img, video, canvas{
			border: 1px solid black;
		}
	</style>

	<script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>

	<script type="text/javascript">
		$(function(){

			var video = document.querySelector('video');
			var canvas = document.querySelector('canvas');
			var localMediaStream = null;


			navigator.webkitGetUserMedia({
				video: true //we willen enkel video
			}, function (stream) {
				video.src = window.webkitURL.createObjectURL(stream);
				localMediaStream = stream;

				//loop();
			}, function(e) {
				console.log('got no stream', e);
			});


			function loop(){
				opencvme(function(){
					loop();
				})
			}


			$("#mustacheme").click(function(){
				if (localMediaStream) {
					canvas.width = $("video").width();
					canvas.height = $("video").height();
					var ctx = canvas.getContext('2d');

					ctx.drawImage(video, 0, 0);
					var base64data = canvas.toDataURL('image/png');
					$("img").attr("src", base64data);

					$.post('/rest/sendphoto',
					{
						photobase64: base64data
					}, function (data) {
						if(data.err){
							console.log(data.errmsg);
							console.log(data.err);
						}else{
							$("img").attr("src", data.mustachedPicurl);
						}
					});
				}
			});

			$("#opencvme").click(function(){
				opencvme();
			});

			function opencvme(callback){
				if (localMediaStream) {
					canvas.width = $("video").width();
					canvas.height = $("video").height();
					var ctx = canvas.getContext('2d');

					ctx.drawImage(video, 0, 0);
					var base64data = canvas.toDataURL('image/png');
					//$("img").attr("src", base64data);

					$.post('/rest/opencv',
					{
						photobase64: base64data
					}, function (data) {
						if(data.err){
							console.log(data.errmsg);
							console.log(data.err);
						}else{
							$("img").attr("src", data.imagedata);
							callback();
						}
					});
				}
			}

		});
	</script>

</head>
	Werkt enkel in Chrome<br />
	Surf eerst naar "about:flags" en klik op "enable" bij "Enable Media Source API"<br />
	<br />
	<video autoplay></video>
	<button id="mustacheme">Mustache Me!</button>
	<button id="opencvme">OpenCV Me!</button>
	<br />

	<img src="">
	<canvas style="display:none"></canvas>
</html>
